{% extends 'base.html' %}
{% block style %}
.showUVContainer {
    margin-top: 2em;
}
{% endblock %}
{% block main %}
    	<!--content-->
{% load static %}
<div class="container">
	<div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
		<ol class="carousel-indicators">
			<li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
			<li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
			<li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
		</ol>
		<div class="carousel-inner">
			<div class="carousel-item active">
				<img class="d-block w-100" src="{% static 'image/indoor1.jpg' %}" height="300px" alt="First slide">
			</div>
			<div class="carousel-item">
				<img class="d-block w-100" src="{% static 'image/indoor2.jpg' %}" height="300px" alt="Second slide">
			</div>
			<div class="carousel-item">
				<img class="d-block w-100" src="{% static 'image/indoor3.jpg' %}" height="300px" alt="Third slide">
			</div>
		</div>
		<a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
			<span class="carousel-control-prev-icon" aria-hidden="true"></span>
			<span class="sr-only">Previous</span>
		</a>
		<a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
			<span class="carousel-control-next-icon" aria-hidden="true"></span>
			<span class="sr-only">Next</span>
		</a>
	</div>
	<br>
	<div class="row">
		<div class="col-md-4 text-center">
			<img src="/static/image/T.jpeg" alt="temperature" height="50" width="50">
			<label>Temperature: {{ data.Tvalue }} ℃</label>
		</div>
		<div class="col-md-4 text-center">
			<img src="/static/image/H.jpeg" alt="temperature" height="50" width="50">
			<label>Humidity: {{ data.Hvalue }} %</label>
		</div>
		<div class="col-md-4 text-center">
			<form action="{% url 'myhome:connection' %}" method="post"> 
			{% csrf_token %}
				<button class="btn btn-info btn-lg" type="submit" name="submit" value='connection'>Detect Environment</button> 
			</form>
		</div>
		<br>
		<div class="col-md-12 text-center">
			<p class="showUVContainer"></p>
			<script src="http://d3js.org/d3.v3.min.js"></script>
		</div>
	</div>
</div>
{% endblock %}

{% block script %}
var label = d3.select(".showUVContainer");

var	margin = {top: 50, right: 20, bottom: 30, left: 50};

var width = 600;
var height = 360;
var	x = d3.scale.linear().range([0, width]);
var	y = d3.scale.linear().range([height, 0]);

var	xAxis = d3.svg.axis().scale(x)
	.orient("bottom").ticks(24);

var	yAxis = d3.svg.axis().scale(y)
	.orient("left").ticks(5);

var	valueline = d3.svg.line()
	.x(function(d) { return x(d.date); })
	.y(function(d) { return y(d.close); });

var	svg = d3.select('.showUVContainer')
	.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.json("/static/json/uv_data.json", function(error, data) {
	data.forEach(function(d) {
		d.date = +d.date
		d.close = +d.close;
	});

	x.domain(d3.extent(data, function(d) { return d.date; }));
	y.domain([0, d3.max(data, function(d) { return d.close; })]);

	svg.append("path")
		.attr("class", "line")
		.attr("d", valueline(data));

	svg.selectAll("circle")
		.data(data)
		.enter()
		.append("circle")
		.attr("r", 10)
	  .attr("cx", function(d) {
	    return x(d.date)
	  })
	  .attr("cy", function(d) {
	    return y(d.close)
	  });



	svg.append("g")			// Add the X Axis
		.attr("class", "x axis")
		.attr("transform", "translate(0," + height + ")")
    .call(xAxis)
    .append("text")
    .text('Hour')
    .attr('text-anchor', 'right')
    .attr('dx', '1em')

	svg.append("g")			// Add the Y Axis
		.attr("class", "y axis")
		.call(yAxis)
    .append("text")
    .text('UV(hourly AVG)')
    .attr('text-anchor', 'end')
    .attr('dx', '4em')
    .attr('dy', '-2em')
    // .attr('transform', 'rotate(90)')

});
{% endblock %}
